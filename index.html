<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>DNA Elimination Jeopardy</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f8ff;
      margin: 0;
      padding: 0;
      text-align: center;
    }
    header {
      background: #003366;
      color: #fff;
      padding: 20px;
    }
    #gameBoard {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 5px;
      max-width: 1200px;
      margin: 20px auto;
      font-size: 1.2em;
    }
    .category, .question {
      background: #007acc;
      color: #fff;
      padding: 20px;
      cursor: pointer;
      border-radius: 5px;
      transition: background 0.3s;
    }
    .category:hover, .question:hover {
      background: #005999;
    }
    .category {
      font-weight: bold;
      cursor: default;
    }
    #scoreBoard {
      max-width: 900px;
      margin: 20px auto;
      display: flex;
      justify-content: space-around;
    }
    .playerScore {
      background: #e0e0e0;
      padding: 15px;
      border-radius: 5px;
      width: 25%;
      transition: box-shadow 0.3s;
    }
    .active-player {
      box-shadow: 0 0 15px 5px gold;
      background: #fffacd;
    }
    /* Modal styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 10;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background: rgba(0,0,0,0.6);
    }
    .modal-content {
      background: #fff;
      margin: 5% auto;
      padding: 20px;
      max-width: 800px;
      border-radius: 5px;
      text-align: left;
    }
    .choice {
      margin: 10px 0;
      padding: 12px;
      background: #f0f0f0;
      cursor: pointer;
      border-radius: 3px;
    }
    .choice:hover {
      background: #ddd;
    }
    .selected {
      background: #cce5ff;
      border: 2px solid #3399ff;
    }
    button {
      margin: 10px 5px 0 5px;
      padding: 10px 20px;
      font-size: 1em;
      cursor: pointer;
    }
    input[type="number"], input[type="text"] {
      font-size: 1em;
      padding: 8px;
      width: 100px;
      margin-right: 10px;
    }
  </style>
</head>
<body>
  <header>
    <h1>DNA Elimination Jeopardy</h1>
    <p>A game based on research about programmed DNA elimination</p>
  </header>
  
  <section id="playerSetup">
    <h2>Player Setup</h2>
    <p>Select number of players:</p>
    <button onclick="startGame(1)">1 Player</button>
    <button onclick="startGame(2)">2 Players</button>
    <button onclick="startGame(3)">3 Players</button>
  </section>
  
  <section id="scoreBoard" style="display:none;"></section>
  
  <section id="gameBoard" style="display:none;"></section>
  
  <!-- Modal for normal questions -->
  <div id="questionModal" class="modal">
    <div class="modal-content">
      <h2 id="questionText"></h2>
      <div id="modalContent"></div>
      <div id="choiceContainer"></div>
      <button id="confirmButton" style="display:none;" onclick="confirmAnswer()">Confirm Answer</button>
      <p id="feedback" style="font-weight:bold;"></p>
      <button onclick="closeModal()">Continue</button>
    </div>
  </div>
  
  <!-- Modal for Final Jeopardy -->
  <div id="finalModal" class="modal">
    <div class="modal-content">
      <h2>Final Jeopardy</h2>
      <div id="finalQuestionContainer"></div>
      <div id="finalPlayerResponses"></div>
      <button id="finalConfirmButton" onclick="finalConfirm()">Submit Final Answers</button>
    </div>
  </div>
  
  <script>
    // Global Variables
    let players = [];
    let currentPlayer = 0;
    let round = 1; // 1 = Jeopardy, 2 = Double Jeopardy
    let questionsAnswered = 0;
    const totalQuestionsPerRound = 30; // 6 categories x 5 questions each
    let roundData = {}; // current round board
    let selectedChoiceIndex = null;
    let currentQuestion = null;
    let currentCategory = "";
    let currentIndex = -1;
    let currentWager = 0; // for Daily Double
    let dailyDoubleIndex = null; // will be set per round
    
    // Full question bank: 12 categories with 5 questions each.
    const fullQuestionBank = {
      "DNA Elimination Basics": [
        {
          question: "What is the primary role of programmed DNA elimination in nematodes?",
          choices: [
            "To remove germline-specific sequences",
            "To repair damaged DNA",
            "To duplicate chromosomes",
            "To stimulate cell division"
          ],
          answer: 0,
          value: 100
        },
        {
          question: "Which statement best describes PDE?",
          choices: [
            "A random DNA loss process",
            "A highly reproducible mechanism",
            "A process for increasing mutation rates",
            "A method to duplicate the genome"
          ],
          answer: 1,
          value: 200
        },
        {
          question: "PDE typically occurs during which developmental stage?",
          choices: [
            "Adult stage",
            "Late embryogenesis",
            "Early embryogenesis",
            "Larval stage"
          ],
          answer: 2,
          value: 300
        },
        {
          question: "What type of genes are often eliminated during PDE?",
          choices: [
            "Housekeeping genes",
            "Germline-expressed genes",
            "Ribosomal RNA genes",
            "Metabolic genes"
          ],
          answer: 1,
          value: 400
        },
        {
          question: "Why is PDE considered irreversible in somatic cells?",
          choices: [
            "Because eliminated DNA is permanently removed",
            "Because DNA is quickly repaired",
            "Because cells can later reinsert the DNA",
            "Because the process is reversible through recombination"
          ],
          answer: 0,
          value: 500
        }
      ],
      "Ascaris": [
        {
          question: "During PDE in Ascaris, what happens to the chromosome ends?",
          choices: [
            "They are elongated",
            "They are methylated",
            "They are broken and re-healed",
            "They fuse with other chromosomes"
          ],
          answer: 2,
          value: 100
        },
        {
          question: "Approximately how many germline-expressed genes are eliminated in Ascaris?",
          choices: [
            "Around 100",
            "About 500",
            "Approximately 1000",
            "Over 2000"
          ],
          answer: 2,
          value: 200
        },
        {
          question: "Which technique enabled the complete assembly of Ascaris chromosomes?",
          choices: [
            "Sanger sequencing",
            "PacBio long-read and Hi-C",
            "RNA-Seq",
            "Microarray analysis"
          ],
          answer: 1,
          value: 300
        },
        {
          question: "What is the outcome of chromosome remodeling in Ascaris after PDE?",
          choices: [
            "Decreased chromosome number",
            "Formation of new somatic chromosomes",
            "Fusion of all chromosomes",
            "Duplication of telomeres"
          ],
          answer: 1,
          value: 400
        },
        {
          question: "Comparative genomics in Ascaris has revealed that PDE contributes to:",
          choices: [
            "Chromosome fusion resolution",
            "Increased gene expression",
            "Random DNA loss",
            "Enhanced DNA repair"
          ],
          answer: 0,
          value: 500
        }
      ],
      "Oscheius tipulae": [
        {
          question: "Which conserved motif is essential for DNA break during PDE in O. tipulae?",
          choices: [
            "TATA box",
            "SFE (Sequence For Elimination)",
            "CAAT box",
            "Poly-A signal"
          ],
          answer: 1,
          value: 100
        },
        {
          question: "At what embryonic stage does PDE occur in O. tipulae?",
          choices: [
            "2-cell stage",
            "4-cell stage",
            "8- to 16-cell stage",
            "Larval stage"
          ],
          answer: 2,
          value: 200
        },
        {
          question: "Why is O. tipulae an attractive model for studying PDE?",
          choices: [
            "Its long life cycle",
            "Its genetic tractability and short life cycle",
            "Its large genome size",
            "Its resistance to genetic manipulation"
          ],
          answer: 1,
          value: 300
        },
        {
          question: "A mutation in which element leads to a 'fail-to-eliminate' phenotype in O. tipulae?",
          choices: [
            "Telomere repeat",
            "SFE motif",
            "Centromere sequence",
            "Promoter region"
          ],
          answer: 1,
          value: 400
        },
        {
          question: "END-seq analysis in O. tipulae revealed that DNA breaks are characterized by:",
          choices: [
            "Minimal end resection",
            "Extensive end resection within the SFE",
            "No observable DNA break",
            "Random distribution with no motif"
          ],
          answer: 1,
          value: 500
        }
      ],
      "Telomere Healing": [
        {
          question: "What is the process that restores broken chromosome ends in nematodes?",
          choices: [
            "Homologous recombination",
            "Nonhomologous end joining",
            "De novo telomere addition",
            "DNA methylation"
          ],
          answer: 2,
          value: 100
        },
        {
          question: "In Ascaris, telomere healing is biased toward which DSB ends?",
          choices: [
            "Retained ends",
            "Eliminated ends",
            "Both equally",
            "Neither"
          ],
          answer: 0,
          value: 200
        },
        {
          question: "Which enzyme is central to the telomere addition process?",
          choices: [
            "DNA polymerase",
            "Telomerase",
            "Ligase",
            "Helicase"
          ],
          answer: 1,
          value: 300
        },
        {
          question: "How does the extent of end resection differ in Ascaris between retained and eliminated ends?",
          choices: [
            "Retained ends are more resected",
            "Eliminated ends are more resected",
            "Both are resected equally",
            "Neither undergoes resection"
          ],
          answer: 1,
          value: 400
        },
        {
          question: "Which technique is used to map de novo telomere addition sites?",
          choices: [
            "END-seq",
            "RNA-Seq",
            "ChIP-Seq",
            "ATAC-Seq"
          ],
          answer: 0,
          value: 500
        }
      ],
      "Evolution & Function": [
        {
          question: "PDE may offer an evolutionary advantage by:",
          choices: [
            "Increasing genome size",
            "Removing harmful germline-specific sequences",
            "Enhancing mutation rates",
            "Stimulating cell proliferation"
          ],
          answer: 1,
          value: 100
        },
        {
          question: "Comparative genomics indicates that PDE:",
          choices: [
            "Evolved in a single lineage",
            "May have evolved independently in different lineages",
            "Is exclusive to parasitic species",
            "Does not impact evolution"
          ],
          answer: 1,
          value: 200
        },
        {
          question: "Elimination of certain genes during PDE primarily serves to:",
          choices: [
            "Prevent their expression in somatic cells",
            "Increase genetic diversity",
            "Enhance cell growth",
            "Trigger DNA repair mechanisms"
          ],
          answer: 0,
          value: 300
        },
        {
          question: "PDE has been linked to the evolution of:",
          choices: [
            "Chromosome fusion resolution",
            "Increased intron density",
            "Expanded mitochondrial genomes",
            "Enhanced protein synthesis"
          ],
          answer: 0,
          value: 400
        },
        {
          question: "How might PDE contribute to speciation in nematodes?",
          choices: [
            "By generating irreversible genomic changes",
            "By promoting gene flow between populations",
            "By conserving ancestral gene order",
            "By increasing horizontal gene transfer"
          ],
          answer: 0,
          value: 500
        }
      ],
      "Methods": [
        {
          question: "Which sequencing method is highlighted for assembling complex genomes in these studies?",
          choices: [
            "Illumina short-read sequencing",
            "PacBio long-read sequencing",
            "Sanger sequencing",
            "Nanopore sequencing"
          ],
          answer: 1,
          value: 100
        },
        {
          question: "Which technique is used to study the 3D organization of chromosomes?",
          choices: [
            "ChIP-Seq",
            "Hi-C",
            "RNA-Seq",
            "ATAC-Seq"
          ],
          answer: 1,
          value: 200
        },
        {
          question: "What does END-seq measure in the context of PDE?",
          choices: [
            "DNA methylation levels",
            "Chromatin accessibility",
            "DNA double-strand break resection",
            "RNA expression levels"
          ],
          answer: 2,
          value: 300
        },
        {
          question: "Which method is used to visualize telomere location during PDE?",
          choices: [
            "FISH (Fluorescence in situ hybridization)",
            "Western blotting",
            "Flow cytometry",
            "PCR"
          ],
          answer: 0,
          value: 400
        },
        {
          question: "Which imaging technique provides ultrastructural details of DNA elimination?",
          choices: [
            "Confocal microscopy",
            "Electron microscopy (EM)",
            "Phase-contrast microscopy",
            "Live-cell imaging"
          ],
          answer: 1,
          value: 500
        }
      ],
      "Research Techniques": [
        {
          question: "Which method is crucial for analyzing chromatin interactions in these studies?",
          choices: [
            "Hi-C",
            "Mass spectrometry",
            "qPCR",
            "FACS"
          ],
          answer: 0,
          value: 100
        },
        {
          question: "What is the primary purpose of using RNA-Seq in genome studies?",
          choices: [
            "To measure DNA damage",
            "To quantify gene expression",
            "To map protein interactions",
            "To analyze chromatin structure"
          ],
          answer: 1,
          value: 200
        },
        {
          question: "Which method is used for isolating long-read DNA fragments?",
          choices: [
            "Canu assembly",
            "Illumina library preparation",
            "PacBio Sequel II",
            "Roche 454"
          ],
          answer: 2,
          value: 300
        },
        {
          question: "Chromosome conformation capture (3C/Hi-C) is used primarily to:",
          choices: [
            "Sequence RNA",
            "Map DNA interactions",
            "Amplify genes",
            "Detect mutations"
          ],
          answer: 1,
          value: 400
        },
        {
          question: "What is the role of optical mapping in genomic studies?",
          choices: [
            "To provide high-resolution protein images",
            "To assist in assembling large repetitive regions",
            "To sequence small RNA fragments",
            "To quantify gene expression levels"
          ],
          answer: 1,
          value: 500
        }
      ],
      "Genomics & Sequencing": [
        {
          question: "Which technology revolutionized the assembly of complex genomes?",
          choices: [
            "Short-read sequencing",
            "Long-read sequencing",
            "Sanger sequencing",
            "PCR-based methods"
          ],
          answer: 1,
          value: 100
        },
        {
          question: "In these studies, Hi-C is used to:",
          choices: [
            "Sequence telomeres",
            "Map chromosome architecture",
            "Detect SNPs",
            "Quantify gene expression"
          ],
          answer: 1,
          value: 200
        },
        {
          question: "Which challenge is specifically addressed by long-read sequencing?",
          choices: [
            "High error rate in base calling",
            "Assembly of repetitive regions",
            "Low throughput",
            "High cost per base"
          ],
          answer: 1,
          value: 300
        },
        {
          question: "What advantage does PacBio sequencing offer for PDE studies?",
          choices: [
            "Shorter read lengths",
            "Ability to span large repetitive regions",
            "Lower accuracy",
            "Faster run times"
          ],
          answer: 1,
          value: 400
        },
        {
          question: "Comparative genomic analysis often relies on:",
          choices: [
            "Randomized controlled trials",
            "Phylogenetic analysis",
            "Double-blind experiments",
            "Metabolomics"
          ],
          answer: 1,
          value: 500
        }
      ],
      "Cellular Processes": [
        {
          question: "PDE affects which cellular process most directly?",
          choices: [
            "Cell metabolism",
            "Chromosome segregation",
            "Protein translation",
            "Membrane transport"
          ],
          answer: 1,
          value: 100
        },
        {
          question: "During PDE, what happens to eliminated DNA?",
          choices: [
            "It is reincorporated into the nucleus",
            "It forms micronuclei and is degraded",
            "It is used for repair",
            "It remains as extra-chromosomal circles"
          ],
          answer: 1,
          value: 200
        },
        {
          question: "The timing of DNA breaks during PDE suggests they occur:",
          choices: [
            "During the S phase",
            "At G2 before mitosis",
            "During cytokinesis",
            "In interphase"
          ],
          answer: 1,
          value: 300
        },
        {
          question: "How are eliminated DNA fragments processed post-break?",
          choices: [
            "They are ligated immediately",
            "They undergo extensive end resection",
            "They are repaired by homologous recombination",
            "They are circularized"
          ],
          answer: 1,
          value: 400
        },
        {
          question: "Which process ensures that only specific DNA is eliminated?",
          choices: [
            "Random breakage",
            "Targeted chromatin remodeling",
            "Global DNA repair",
            "Uncontrolled cell division"
          ],
          answer: 1,
          value: 500
        }
      ],
      "Molecular Mechanisms": [
        {
          question: "Which molecular process is central to initiating PDE?",
          choices: [
            "DNA replication",
            "Generation of double-strand breaks",
            "Transcriptional activation",
            "Protein degradation"
          ],
          answer: 1,
          value: 100
        },
        {
          question: "What molecular marker is often associated with open chromatin during PDE?",
          choices: [
            "Histone acetylation",
            "DNA methylation",
            "Histone deacetylation",
            "Ubiquitination"
          ],
          answer: 0,
          value: 200
        },
        {
          question: "In the context of PDE, what does END-seq detect?",
          choices: [
            "RNA expression",
            "DNA double-strand break resection",
            "Protein interactions",
            "Chromosome condensation"
          ],
          answer: 1,
          value: 300
        },
        {
          question: "Telomere healing is an example of which molecular process?",
          choices: [
            "De novo synthesis",
            "RNA splicing",
            "Post-translational modification",
            "Signal transduction"
          ],
          answer: 0,
          value: 400
        },
        {
          question: "The failure of telomere healing on eliminated DNA suggests:",
          choices: [
            "A passive process",
            "A regulated mechanism for repair bias",
            "An error in DNA replication",
            "A random event"
          ],
          answer: 1,
          value: 500
        }
      ],
      "Comparative Genomics": [
        {
          question: "Comparative genomics helps researchers to:",
          choices: [
            "Determine gene expression levels",
            "Compare genome structure across species",
            "Measure protein activity",
            "Analyze cell morphology"
          ],
          answer: 1,
          value: 100
        },
        {
          question: "In the context of PDE, comparative genomics has revealed:",
          choices: [
            "Identical elimination events in all species",
            "Diverse mechanisms of chromosome remodeling",
            "No significant differences between species",
            "Uniform gene loss patterns"
          ],
          answer: 1,
          value: 200
        },
        {
          question: "What does the study of fused chromosomes in Ascaris primarily illustrate?",
          choices: [
            "Genome duplication",
            "Chromosome resolution during PDE",
            "RNA editing",
            "Protein synthesis"
          ],
          answer: 1,
          value: 300
        },
        {
          question: "Comparing PDE across species can help reveal:",
          choices: [
            "Evolutionary conservation and divergence",
            "Only the conserved features",
            "Uniform telomere lengths",
            "Identical gene sequences"
          ],
          answer: 0,
          value: 400
        },
        {
          question: "What is a potential evolutionary consequence of PDE?",
          choices: [
            "Increased cell size",
            "Speciation via genomic restructuring",
            "Reduced metabolic rate",
            "Enhanced immune response"
          ],
          answer: 1,
          value: 500
        }
      ],
      "Experimental Techniques": [
        {
          question: "Which technique is used to detect DNA breaks at a genome-wide level?",
          choices: [
            "END-seq",
            "Western blot",
            "ELISA",
            "Mass spectrometry"
          ],
          answer: 0,
          value: 100
        },
        {
          question: "What role does fluorescence in situ hybridization (FISH) play in PDE studies?",
          choices: [
            "Detecting protein-protein interactions",
            "Visualizing telomere locations",
            "Sequencing DNA",
            "Measuring gene expression"
          ],
          answer: 1,
          value: 200
        },
        {
          question: "Which method helps in assembling highly repetitive regions of the genome?",
          choices: [
            "Short-read sequencing",
            "Long-read sequencing",
            "PCR amplification",
            "Microarray analysis"
          ],
          answer: 1,
          value: 300
        },
        {
          question: "How does chromosome conformation capture (Hi-C) contribute to these studies?",
          choices: [
            "It sequences telomeres",
            "It maps chromosomal interactions",
            "It identifies gene mutations",
            "It amplifies DNA segments"
          ],
          answer: 1,
          value: 400
        },
        {
          question: "Which imaging method provides ultrastructural details of cellular processes like PDE?",
          choices: [
            "Light microscopy",
            "Electron microscopy",
            "Fluorescence microscopy",
            "Phase-contrast microscopy"
          ],
          answer: 1,
          value: 500
        }
      ]
    };
    
    // Final Jeopardy bank: extra hard questions.
    const finalJeopardyBank = [
      {
        question: "Final Jeopardy: Which integrated combination of long-read sequencing and chromatin conformation capture has most advanced our understanding of PDE in nematodes?",
        choices: [
          "A. Illumina paired-end sequencing and ChIP-Seq",
          "B. Sanger sequencing and RNA-Seq",
          "C. PacBio long-read sequencing and Hi-C",
          "D. Nanopore sequencing and ATAC-Seq"
        ],
        answer: 2
      },
      {
        question: "Final Jeopardy: In the context of PDE, what mechanism is primarily responsible for the selective loss of germline-expressed genes?",
        choices: [
          "A. Random mutation accumulation",
          "B. Targeted double-strand break formation followed by telomere healing",
          "C. Global epigenetic silencing",
          "D. Unequal chromosomal segregation"
        ],
        answer: 1
      },
      {
        question: "Final Jeopardy: Comparative analysis of PDE in Ascaris versus Oscheius tipulae reveals which key difference in DNA break repair?",
        choices: [
          "A. Only Ascaris uses homologous recombination",
          "B. Oscheius tipulae exhibits unbiased telomere healing on both retained and eliminated ends",
          "C. Ascaris shows a repair bias favoring retained ends for telomere healing",
          "D. Both species use nonhomologous end joining exclusively"
        ],
        answer: 2
      }
    ];
    
    // Utility: Shuffle an array in-place.
    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }
    
    // Initialize the game board for a round.
    function initializeRound() {
      questionsAnswered = 0;
      // For each round, randomly pick 6 categories from fullQuestionBank.
      const categories = Object.keys(fullQuestionBank);
      let chosenCategories = shuffle([...categories]).slice(0, 6);
      roundData = {};
      chosenCategories.forEach(cat => {
        // Shuffle questions in each category.
        roundData[cat] = shuffle([...fullQuestionBank[cat]]);
        // Apply round multiplier.
        roundData[cat].forEach(q => {
          q.originalValue = q.value; // store base value
          q.value = q.value * (round === 1 ? 1 : 2);
        });
      });
      // Pick a random Daily Double among the 30 questions.
      const allQuestions = [];
      Object.keys(roundData).forEach(cat => {
        roundData[cat].forEach((q, idx) => {
          allQuestions.push({cat, idx});
        });
      });
      const ddChoice = allQuestions[Math.floor(Math.random() * allQuestions.length)];
      roundData[ddChoice.cat][ddChoice.idx].dailyDouble = true;
      // Generate the board.
      generateBoard();
    }
    
    // Generate the game board HTML from roundData.
    function generateBoard() {
      const gameBoard = document.getElementById('gameBoard');
      gameBoard.innerHTML = "";
      // Create category headers.
      Object.keys(roundData).forEach(cat => {
        const div = document.createElement('div');
        div.className = 'category';
        div.textContent = cat;
        gameBoard.appendChild(div);
      });
      // For 5 questions per category.
      for (let i = 0; i < 5; i++) {
        Object.keys(roundData).forEach(cat => {
          const qData = roundData[cat][i];
          const cell = document.createElement('div');
          cell.className = 'question';
          cell.id = cat + "-" + i;
          cell.textContent = "$" + qData.value;
          cell.onclick = function() { openQuestion(cat, i); };
          gameBoard.appendChild(cell);
        });
      }
      gameBoard.style.display = 'grid';
    }
    
    // Start the game with a given number of players.
    function startGame(numPlayers) {
      players = [];
      for (let i = 1; i <= numPlayers; i++) {
        players.push({ name: "Player " + i, score: 0 });
      }
      currentPlayer = 0;
      round = 1;
      document.getElementById('playerSetup').style.display = 'none';
      displayScoreBoard();
      initializeRound();
      document.getElementById('gameBoard').style.display = 'grid';
    }
    
    // Display the scoreboard and highlight the active player.
    function displayScoreBoard() {
      const scoreBoard = document.getElementById('scoreBoard');
      scoreBoard.innerHTML = "";
      players.forEach((player, index) => {
        const div = document.createElement('div');
        div.className = 'playerScore';
        div.id = 'player' + index;
        if (index === currentPlayer) {
          div.classList.add('active-player');
        }
        div.innerHTML = `<h3>${player.name}</h3><p>Score: <span id="score${index}">${player.score}</span></p>`;
        scoreBoard.appendChild(div);
      });
      scoreBoard.style.display = 'flex';
    }
    
    // Open a question (or Daily Double prompt).
    function openQuestion(category, index) {
      if (!roundData[category] || !roundData[category][index]) return;
      currentCategory = category;
      currentIndex = index;
      currentQuestion = roundData[category][index];
      selectedChoiceIndex = null;
      currentWager = 0;
      
      document.getElementById('questionText').textContent = currentQuestion.question;
      document.getElementById('modalContent').innerHTML = "";
      document.getElementById('choiceContainer').innerHTML = "";
      document.getElementById('feedback').textContent = "";
      document.getElementById('confirmButton').style.display = 'none';
      
      // If Daily Double, prompt for wager.
      if (currentQuestion.dailyDouble) {
        const maxWager = players[currentPlayer].score > 0 ? players[currentPlayer].score : 1000;
        const wagerDiv = document.createElement('div');
        wagerDiv.innerHTML = `<p><strong>Daily Double!</strong> Enter your wager (max: ${maxWager}):</p>`;
        const wagerInput = document.createElement('input');
        wagerInput.type = "number";
        wagerInput.id = "wagerInput";
        wagerInput.value = currentQuestion.value;
        wagerDiv.appendChild(wagerInput);
        const wagerButton = document.createElement('button');
        wagerButton.textContent = "Confirm Wager";
        wagerButton.onclick = confirmWager;
        wagerDiv.appendChild(wagerButton);
        document.getElementById('modalContent').appendChild(wagerDiv);
      } else {
        showChoices();
      }
      document.getElementById('questionModal').style.display = 'block';
    }
    
    // Confirm wager for Daily Double.
    function confirmWager() {
      const wagerInput = document.getElementById('wagerInput');
      let wager = parseInt(wagerInput.value);
      const maxWager = players[currentPlayer].score > 0 ? players[currentPlayer].score : 1000;
      if (isNaN(wager) || wager <= 0) {
        alert("Please enter a positive wager.");
        return;
      }
      if (wager > maxWager) {
        alert("Your wager cannot exceed " + maxWager + " points.");
        return;
      }
      currentWager = wager;
      document.getElementById('modalContent').innerHTML = "";
      showChoices();
    }
    
    // Display the multiple-choice options.
    function showChoices() {
      const choiceContainer = document.getElementById('choiceContainer');
      choiceContainer.innerHTML = "";
      currentQuestion.choices.forEach((choice, idx) => {
        const p = document.createElement('p');
        p.className = 'choice';
        p.textContent = choice;
        p.onclick = function() { selectChoice(p, idx); };
        choiceContainer.appendChild(p);
      });
      document.getElementById('confirmButton').style.display = 'inline-block';
    }
    
    // Highlight a selected choice.
    function selectChoice(element, idx) {
      const choices = document.getElementsByClassName('choice');
      for (let i = 0; i < choices.length; i++) {
        choices[i].classList.remove('selected');
      }
      element.classList.add('selected');
      selectedChoiceIndex = idx;
    }
    
    // Confirm the answer and update score.
    function confirmAnswer() {
      if (selectedChoiceIndex === null) {
        alert("Please select an answer before confirming.");
        return;
      }
      let wagerOrValue = currentQuestion.dailyDouble ? currentWager : currentQuestion.value;
      let feedbackText = "";
      if (selectedChoiceIndex === currentQuestion.answer) {
        feedbackText = "Correct! You gain " + wagerOrValue + " points.";
        players[currentPlayer].score += wagerOrValue;
        // In multiplayer, if correct, the same player continues.
      } else {
        feedbackText = "Incorrect. The correct answer was: " + currentQuestion.choices[currentQuestion.answer] +
                       ". You lose " + wagerOrValue + " points.";
        players[currentPlayer].score -= wagerOrValue;
        if (players.length > 1) {
          currentPlayer = (currentPlayer + 1) % players.length;
        }
      }
      document.getElementById('feedback').textContent = feedbackText;
      updateScoreBoard();
      updateActivePlayerDisplay();
      delete roundData[currentCategory][currentIndex];
      const cell = document.getElementById(currentCategory + "-" + currentIndex);
      if (cell) {
        cell.style.background = "#555";
        cell.style.color = "#aaa";
        cell.onclick = null;
        cell.textContent = "";
      }
      document.getElementById('confirmButton').style.display = 'none';
      questionsAnswered++;
      if (questionsAnswered === totalQuestionsPerRound) {
        if (round === 1) {
          // Transition to Double Jeopardy Round.
          round = 2;
          alert("Round 1 complete! Now entering Double Jeopardy (point values doubled).");
          initializeRound();
        } else {
          // Proceed to Final Jeopardy.
          setTimeout(startFinalJeopardy, 1000);
        }
      }
    }
    
    function updateScoreBoard() {
      players.forEach((player, index) => {
        document.getElementById('score' + index).textContent = player.score;
      });
    }
    
    function updateActivePlayerDisplay() {
      players.forEach((_, index) => {
        const playerDiv = document.getElementById('player' + index);
        if (index === currentPlayer) {
          playerDiv.classList.add('active-player');
        } else {
          playerDiv.classList.remove('active-player');
        }
      });
    }
    
    function closeModal() {
      document.getElementById('questionModal').style.display = 'none';
    }
    
    // Final Jeopardy round.
    function startFinalJeopardy() {
      document.getElementById('gameBoard').style.display = 'none';
      // Randomly select one final question.
      const finalQuestion = finalJeopardyBank[Math.floor(Math.random() * finalJeopardyBank.length)];
      // Build final round interface.
      const container = document.getElementById('finalQuestionContainer');
      container.innerHTML = `<h3>${finalQuestion.question}</h3>`;
      // For each player, create input fields for wager and answer.
      const responsesDiv = document.getElementById('finalPlayerResponses');
      responsesDiv.innerHTML = "";
      players.forEach((player, idx) => {
        responsesDiv.innerHTML += `<div id="finalPlayer${idx}">
          <h4>${player.name} (Current Score: ${player.score})</h4>
          <p>Enter your wager (max: ${player.score > 0 ? player.score : 1000}): <input type="number" id="finalWager${idx}" value="0"></p>
          <p>Your Answer: <input type="text" id="finalAnswer${idx}" placeholder="Type answer here"></p>
          </div><hr>`;
      });
      // Store final question for later evaluation.
      window.finalQuestion = finalQuestion;
      document.getElementById('finalModal').style.display = 'block';
    }
    
    // Final Jeopardy confirmation: update scores based on answers.
    function finalConfirm() {
      players.forEach((player, idx) => {
        const wager = parseInt(document.getElementById('finalWager' + idx).value);
        const answer = document.getElementById('finalAnswer' + idx).value.trim();
        const maxWager = player.score > 0 ? player.score : 1000;
        let wagerVal = isNaN(wager) || wager <= 0 ? 0 : wager;
        if (wagerVal > maxWager) wagerVal = maxWager;
        // Check answer (case-insensitive exact match of the letter, e.g., "C")
        // For simplicity, we expect the answer to start with the option letter.
        const correctOption = window.finalQuestion.choices[window.finalQuestion.answer].charAt(0).toUpperCase();
        const givenOption = answer.charAt(0).toUpperCase();
        if (givenOption === correctOption) {
          player.score += wagerVal;
        } else {
          player.score -= wagerVal;
        }
      });
      updateScoreBoard();
      alert("Final Jeopardy complete! Check the scoreboard.");
      document.getElementById('finalModal').style.display = 'none';
    }
  </script>
</body>
</html>
