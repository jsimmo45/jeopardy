<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Programmed DNA Elimination Jeopardy!</title>
  <style>
    /* Increase base font sizes for better visibility */
    body {
      font-family: Arial, sans-serif;
      background: #f0f8ff;
      margin: 0;
      padding: 0;
      text-align: center;
      font-size: 1.6em;
    }
    header {
      background: #003366;
      color: #fff;
      padding: 30px;
      font-size: 2.5em;
    }
    /* Enlarged game board */
    #gameBoard {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 10px;
      max-width: 1200px;
      margin: 20px auto;
    }
    .category, .question {
      background: #007acc;
      color: #fff;
      padding: 30px;
      font-size: 1.8em;
      cursor: pointer;
      border-radius: 8px;
      transition: background 0.3s;
    }
    .category:hover, .question:hover {
      background: #005999;
    }
    .category {
      font-weight: bold;
      cursor: default;
    }
    /* Scoreboard styles */
    #scoreBoard {
      max-width: 1000px;
      margin: 20px auto;
      display: flex;
      justify-content: space-around;
      font-size: 1.6em;
    }
    .playerScore {
      background: #e0e0e0;
      padding: 20px;
      border-radius: 8px;
      width: 30%;
      transition: box-shadow 0.3s;
    }
    .active-player {
      box-shadow: 0 0 15px 5px gold;
      background: #fffacd;
    }
    /* Player Setup Styles */
    #playerSetup {
      max-width: 600px;
      margin: 30px auto;
      font-size: 1.6em;
    }
    #nameInputs {
      margin-top: 20px;
    }
    input[type="text"] {
      padding: 10px;
      font-size: 1em;
      margin: 5px;
      width: 80%;
    }
    button {
      margin: 10px 5px 0 5px;
      padding: 12px 25px;
      font-size: 1em;
      cursor: pointer;
    }
    /* Modal styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 10;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background: rgba(0,0,0,0.6);
    }
    .modal-content {
      background: #fff;
      margin: 5% auto;
      padding: 20px;
      max-width: 800px;
      border-radius: 8px;
      text-align: left;
      font-size: 1.4em;
    }
    .choice {
      margin: 12px 0;
      padding: 15px;
      background: #f0f0f0;
      cursor: pointer;
      border-radius: 5px;
    }
    .choice:hover {
      background: #ddd;
    }
    .selected {
      background: #cce5ff;
      border: 2px solid #3399ff;
    }
    hr {
      border: 1px solid #ccc;
      margin: 20px 0;
    }
  </style>
</head>
<body>
  <header>
    <h1>Programmed DNA Elimination Jeopardy!</h1>
  </header>
  
  <!-- Player Setup Section -->
  <section id="playerSetup">
    <h2>Player Setup</h2>
    <p>Select number of players:</p>
    <button onclick="prepareNameInputs(1)">1 Player</button>
    <button onclick="prepareNameInputs(2)">2 Players</button>
    <button onclick="prepareNameInputs(3)">3 Players</button>
    <div id="nameInputs" style="display:none;"></div>
  </section>
  
  <!-- Scoreboard -->
  <section id="scoreBoard" style="display:none;"></section>
  
  <!-- Game Board -->
  <section id="gameBoard" style="display:none;"></section>
  
  <!-- Modal for questions -->
  <div id="questionModal" class="modal">
    <div class="modal-content">
      <h2 id="questionText"></h2>
      <div id="modalContent"></div>
      <div id="choiceContainer"></div>
      <button id="confirmButton" style="display:none;" onclick="confirmAnswer()">Confirm Answer</button>
      <p id="feedback" style="font-weight:bold;"></p>
      <button onclick="closeModal()">Continue</button>
    </div>
  </div>
  
  <!-- Modal for Final Jeopardy -->
  <div id="finalModal" class="modal">
    <div class="modal-content">
      <h2>Final Jeopardy</h2>
      <div id="finalQuestionContainer"></div>
      <div id="finalPlayerResponses"></div>
      <button id="finalConfirmButton" onclick="finalConfirm()">Submit Final Answers</button>
    </div>
  </div>
  
  <script>
    // Global Variables
    let players = [];
    let currentPlayer = 0;
    let round = 1; // 1 = Jeopardy, 2 = Double Jeopardy
    let questionsAnswered = 0;
    const totalQuestionsPerRound = 25; // 5 categories x 5 questions each
    let roundData = {}; // Board data for current round
    let currentCategories = []; // Array to hold chosen categories (fixed order for the board)
    let selectedChoiceIndex = null;
    let currentQuestion = null;
    let currentCategory = "";
    let currentIndex = -1;
    let currentWager = 0; // For Daily Double
    
    // Full question bank with 5 questions per category (including explanations)
    // We now add a new category "Data & Interpretation" with tougher, data‚Äêdriven questions.
    const fullQuestionBank = {
      "DNA Elimination Basics": [
        {
          question: "What is the primary role of programmed DNA elimination in nematodes?",
          choices: [
            "To remove germline-specific sequences",
            "To repair damaged DNA",
            "To duplicate chromosomes",
            "To stimulate cell division"
          ],
          answer: 0,
          value: 100,
          explanation: "PDE removes germline-specific sequences from somatic cells to permanently silence them."
        },
        {
          question: "Which statement best describes PDE?",
          choices: [
            "A random DNA loss process",
            "A highly reproducible mechanism",
            "A process for increasing mutation rates",
            "A method to duplicate the genome"
          ],
          answer: 1,
          value: 200,
          explanation: "PDE is tightly regulated and reproducible, ensuring the same sequences are eliminated each time."
        },
        {
          question: "PDE typically occurs during which developmental stage?",
          choices: [
            "Adult stage",
            "Late embryogenesis",
            "Early embryogenesis",
            "Larval stage"
          ],
          answer: 2,
          value: 300,
          explanation: "PDE occurs during early embryogenesis when the germline and somatic lineages are first distinguished."
        },
        {
          question: "What type of genes are typically eliminated during PDE?",
          choices: [
            "Housekeeping genes",
            "Germline-expressed genes",
            "Ribosomal RNA genes",
            "Metabolic genes"
          ],
          answer: 1,
          value: 400,
          explanation: "Germline-expressed genes are removed to prevent their inappropriate expression in somatic cells."
        },
        {
          question: "Why is PDE considered irreversible in somatic cells?",
          choices: [
            "Because eliminated DNA is permanently lost",
            "Because DNA is quickly repaired",
            "Because cells can reinsert the DNA later",
            "Because the process is reversible through recombination"
          ],
          answer: 0,
          value: 500,
          explanation: "Once DNA is eliminated in somatic cells, it is permanently removed from the genome."
        }
      ],
      "Ascaris": [
        {
          question: "During PDE in Ascaris, what happens to the chromosome ends?",
          choices: [
            "They are elongated",
            "They are methylated",
            "They are broken and re-healed",
            "They fuse with other chromosomes"
          ],
          answer: 2,
          value: 100,
          explanation: "Chromosome ends in Ascaris are broken and then re-healed by de novo telomere addition."
        },
        {
          question: "Approximately how many germline-expressed genes are eliminated in Ascaris?",
          choices: [
            "Around 100",
            "About 500",
            "Approximately 1000",
            "Over 2000"
          ],
          answer: 2,
          value: 200,
          explanation: "Research indicates that roughly 1000 germline-expressed genes are eliminated during PDE in Ascaris."
        },
        {
          question: "Which technique enabled the complete assembly of Ascaris chromosomes?",
          choices: [
            "Sanger sequencing",
            "PacBio long-read sequencing with Hi-C",
            "RNA-Seq",
            "Microarray analysis"
          ],
          answer: 1,
          value: 300,
          explanation: "The use of PacBio long-read sequencing in combination with Hi-C was key to assembling the complex Ascaris genome."
        },
        {
          question: "What is the outcome of chromosome remodeling in Ascaris after PDE?",
          choices: [
            "Decreased chromosome number",
            "Formation of new somatic chromosomes",
            "Fusion of all chromosomes",
            "Duplication of telomeres"
          ],
          answer: 1,
          value: 400,
          explanation: "Chromosome remodeling results in the splitting of germline chromosomes into additional somatic chromosomes."
        },
        {
          question: "Comparative genomics in Ascaris has revealed that PDE contributes to:",
          choices: [
            "Resolution of chromosome fusions",
            "Increased gene expression",
            "Random DNA loss",
            "Enhanced DNA repair"
          ],
          answer: 0,
          value: 500,
          explanation: "PDE helps resolve fused chromosomes, contributing to a refined somatic karyotype."
        }
      ],
      "Oscheius tipulae": [
        {
          question: "Which conserved motif is essential for DNA break during PDE in O. tipulae?",
          choices: [
            "TATA box",
            "SFE (Sequence For Elimination)",
            "CAAT box",
            "Poly-A signal"
          ],
          answer: 1,
          value: 100,
          explanation: "The SFE motif is crucial for specifying where DNA breaks occur during PDE in O. tipulae."
        },
        {
          question: "At what embryonic stage does PDE occur in O. tipulae?",
          choices: [
            "2-cell stage",
            "4-cell stage",
            "8- to 16-cell stage",
            "Larval stage"
          ],
          answer: 2,
          value: 200,
          explanation: "PDE in O. tipulae takes place during the 8- to 16-cell stage of embryogenesis."
        },
        {
          question: "Why is O. tipulae an attractive model for studying PDE?",
          choices: [
            "Its long life cycle",
            "Its genetic tractability and short life cycle",
            "Its large genome size",
            "Its resistance to genetic manipulation"
          ],
          answer: 1,
          value: 300,
          explanation: "O. tipulae‚Äôs short life cycle and ease of genetic manipulation make it an ideal model for studying PDE."
        },
        {
          question: "A mutation in which element leads to a 'fail-to-eliminate' phenotype in O. tipulae?",
          choices: [
            "Telomere repeat",
            "SFE motif",
            "Centromere sequence",
            "Promoter region"
          ],
          answer: 1,
          value: 400,
          explanation: "Mutations in the SFE motif disrupt the DNA break process, leading to a failure in proper DNA elimination."
        },
        {
          question: "END-seq analysis in O. tipulae revealed that DNA breaks are characterized by:",
          choices: [
            "Minimal end resection",
            "Extensive end resection within the SFE",
            "No observable DNA break",
            "Random distribution with no motif"
          ],
          answer: 1,
          value: 500,
          explanation: "END-seq shows that DNA breaks in O. tipulae involve extensive resection specifically at the SFE motif."
        }
      ],
      "Telomere Healing": [
        {
          question: "What is the process that restores broken chromosome ends in nematodes?",
          choices: [
            "Homologous recombination",
            "Nonhomologous end joining",
            "De novo telomere addition",
            "DNA methylation"
          ],
          answer: 2,
          value: 100,
          explanation: "Broken ends are restored by de novo telomere addition, a critical repair process during PDE."
        },
        {
          question: "In Ascaris, telomere healing is biased toward which DSB ends?",
          choices: [
            "Retained ends",
            "Eliminated ends",
            "Both equally",
            "Neither"
          ],
          answer: 0,
          value: 200,
          explanation: "Telomere healing preferentially occurs on the retained ends, ensuring the integrity of somatic chromosomes."
        },
        {
          question: "Which enzyme is central to the telomere addition process?",
          choices: [
            "DNA polymerase",
            "Telomerase",
            "Ligase",
            "Helicase"
          ],
          answer: 1,
          value: 300,
          explanation: "Telomerase is responsible for adding telomeric repeats to broken chromosome ends during healing."
        },
        {
          question: "How does the extent of end resection differ in Ascaris between retained and eliminated ends?",
          choices: [
            "Retained ends are more resected",
            "Eliminated ends are more resected",
            "Both are resected equally",
            "Neither undergoes resection"
          ],
          answer: 1,
          value: 400,
          explanation: "Eliminated ends show more extensive resection compared to retained ends, affecting telomere healing outcomes."
        },
        {
          question: "Which technique is used to map de novo telomere addition sites?",
          choices: [
            "END-seq",
            "RNA-Seq",
            "ChIP-Seq",
            "ATAC-Seq"
          ],
          answer: 0,
          value: 500,
          explanation: "END-seq is the method used to pinpoint where new telomeres are added after DNA breaks."
        }
      ],
      "Evolution & Function": [
        {
          question: "PDE may offer an evolutionary advantage by:",
          choices: [
            "Increasing genome size",
            "Removing harmful germline-specific sequences",
            "Enhancing mutation rates",
            "Stimulating cell proliferation"
          ],
          answer: 1,
          value: 100,
          explanation: "By eliminating germline-specific sequences, PDE streamlines the somatic genome for efficient function."
        },
        {
          question: "Comparative genomics indicates that PDE:",
          choices: [
            "Evolved in a single lineage",
            "May have evolved independently in different lineages",
            "Is exclusive to parasitic species",
            "Does not impact evolution"
          ],
          answer: 1,
          value: 200,
          explanation: "PDE appears to have evolved independently in various groups, demonstrating convergent evolution."
        },
        {
          question: "Elimination of certain genes during PDE primarily serves to:",
          choices: [
            "Prevent their expression in somatic cells",
            "Increase genetic diversity",
            "Enhance cell growth",
            "Trigger DNA repair mechanisms"
          ],
          answer: 0,
          value: 300,
          explanation: "Removing these genes prevents their expression in somatic cells, which is essential for proper differentiation."
        },
        {
          question: "PDE has been linked to the evolution of:",
          choices: [
            "Chromosome fusion resolution",
            "Increased intron density",
            "Expanded mitochondrial genomes",
            "Enhanced protein synthesis"
          ],
          answer: 0,
          value: 400,
          explanation: "PDE aids in resolving fused chromosomes, which refines the karyotype over evolutionary time."
        },
        {
          question: "How might PDE contribute to speciation in nematodes?",
          choices: [
            "By generating irreversible genomic changes",
            "By promoting gene flow between populations",
            "By conserving ancestral gene order",
            "By increasing horizontal gene transfer"
          ],
          answer: 0,
          value: 500,
          explanation: "Irreversible genomic changes from PDE can lead to reproductive isolation, fostering speciation."
        }
      ],
      "Data & Interpretation": [
        {
          question: "What does the consistent loss of subtelomeric regions during PDE in Ascaris suggest about chromosome evolution?",
          choices: [
            "It indicates random genomic degradation",
            "It reflects an evolutionary mechanism to resolve chromosome fusions",
            "It is a byproduct of high mutation rates",
            "It results from experimental error"
          ],
          answer: 1,
          value: 100,
          explanation: "The loss of subtelomeric regions is thought to be an adaptation to resolve fused chromosomes into independent units."
        },
        {
          question: "How does the observed extensive end resection at DNA break sites inform our understanding of telomere healing?",
          choices: [
            "It suggests that telomere healing is error-prone",
            "It indicates a regulated process distinguishing retained from eliminated DNA",
            "It implies that resection is irrelevant to healing",
            "It shows that resection only occurs in germline cells"
          ],
          answer: 1,
          value: 200,
          explanation: "Extensive resection before telomere addition suggests a controlled mechanism that favors repair of retained DNA."
        },
        {
          question: "In the research data, what is the significance of detecting a fail-safe mechanism with additional DNA breaks during PDE?",
          choices: [
            "It increases the chance of complete gene loss",
            "It ensures that no residual germline-specific DNA remains in somatic cells",
            "It serves to initiate apoptosis",
            "It compensates for telomere shortening"
          ],
          answer: 1,
          value: 300,
          explanation: "The additional breaks act as a fail-safe to ensure that unwanted DNA is fully eliminated from somatic cells."
        },
        {
          question: "What does the differential telomere healing between retained and eliminated DNA imply about the repair mechanisms?",
          choices: [
            "Both types of DNA are repaired identically",
            "A specific repair bias favors healing of retained DNA",
            "Telomere healing is completely random",
            "Healing depends solely on DNA sequence context"
          ],
          answer: 1,
          value: 400,
          explanation: "The data indicate that telomere healing predominantly occurs on retained DNA ends, implying a bias in the repair mechanism."
        },
        {
          question: "Based on the data from Ascaris and O. tipulae, how might PDE contribute to genomic evolution in nematodes?",
          choices: [
            "By introducing extensive point mutations",
            "Through generation of novel somatic chromosomes and resolution of fused chromosomes",
            "By maintaining a constant genome size",
            "By increasing the frequency of homologous recombination"
          ],
          answer: 1,
          value: 500,
          explanation: "PDE reshapes chromosome structure by creating new somatic chromosomes and resolving fusions, thereby driving genomic evolution."
        }
      ]
    };
    
    // Final Jeopardy bank (extra hard questions)
    const finalJeopardyBank = [
      {
        question: "Final Jeopardy: Which integrated combination of long-read sequencing and chromatin conformation capture has most advanced our understanding of PDE in nematodes?",
        choices: [
          "A. Illumina paired-end sequencing and ChIP-Seq",
          "B. Sanger sequencing and RNA-Seq",
          "C. PacBio long-read sequencing and Hi-C",
          "D. Nanopore sequencing and ATAC-Seq"
        ],
        answer: 2,
        explanation: "The combination of PacBio long-read sequencing with Hi-C has been pivotal in assembling complex genomes and revealing PDE dynamics."
      },
      {
        question: "Final Jeopardy: In the context of PDE, what mechanism is primarily responsible for the selective loss of germline-expressed genes?",
        choices: [
          "A. Random mutation accumulation",
          "B. Targeted double-strand break formation followed by telomere healing",
          "C. Global epigenetic silencing",
          "D. Unequal chromosomal segregation"
        ],
        answer: 1,
        explanation: "Selective loss is achieved through targeted DSB formation and subsequent telomere healing, effectively removing specific genes."
      },
      {
        question: "Final Jeopardy: Comparative analysis of PDE in Ascaris versus Oscheius tipulae reveals which key difference in DNA break repair?",
        choices: [
          "A. Only Ascaris uses homologous recombination",
          "B. Oscheius tipulae exhibits unbiased telomere healing on both retained and eliminated ends",
          "C. Ascaris shows a repair bias favoring retained ends for telomere healing",
          "D. Both species use nonhomologous end joining exclusively"
        ],
        answer: 2,
        explanation: "Ascaris exhibits a bias in repair that favors telomere healing on retained ends, unlike the more uniform healing in O. tipulae."
      }
    ];
    
    // Utility: Shuffle an array in place.
    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }
    
    // ---------------- Player Setup Functions ----------------
    function prepareNameInputs(numPlayers) {
      document.getElementById('nameInputs').style.display = 'block';
      let html = "";
      for (let i = 1; i <= numPlayers; i++) {
        html += `<p>Enter name for Player ${i}: <input type="text" id="playerName${i}" placeholder="Player ${i}"></p>`;
      }
      html += `<button onclick="startGameWithNames(${numPlayers})">Start Game</button>`;
      document.getElementById('nameInputs').innerHTML = html;
    }
    
    function startGameWithNames(numPlayers) {
      players = [];
      for (let i = 1; i <= numPlayers; i++) {
        let name = document.getElementById('playerName' + i).value;
        if (!name.trim()) name = "Player " + i;
        players.push({ name: name, score: 0 });
      }
      currentPlayer = 0;
      round = 1;
      document.getElementById('playerSetup').style.display = 'none';
      displayScoreBoard();
      initializeRound();
      document.getElementById('gameBoard').style.display = 'grid';
    }
    
    // ---------------- Game Board Initialization ----------------
    function initializeRound() {
      questionsAnswered = 0;
      // Choose 5 random categories from the full bank.
      const categories = Object.keys(fullQuestionBank);
      let chosenCategories = shuffle([...categories]).slice(0, 5);
      currentCategories = [...chosenCategories]; // store fixed order for this round
      roundData = {};
      currentCategories.forEach(cat => {
        // Create a copy sorted by ascending value (ensuring $100 is at index 0, etc.)
        roundData[cat] = [...fullQuestionBank[cat]].sort((a, b) => a.value - b.value);
        // Apply round multiplier (Round 2 values are doubled).
        roundData[cat].forEach(q => {
          q.originalValue = q.value;
          q.value = q.value * (round === 1 ? 1 : 2);
        });
      });
      // Pick one random Daily Double among the 25 questions.
      const allQuestions = [];
      currentCategories.forEach(cat => {
        roundData[cat].forEach((q, idx) => {
          allQuestions.push({ cat, idx });
        });
      });
      const ddChoice = allQuestions[Math.floor(Math.random() * allQuestions.length)];
      roundData[ddChoice.cat][ddChoice.idx].dailyDouble = true;
      generateBoard();
    }
    
    // Generate the game board using currentCategories to fix column order.
    function generateBoard() {
      const gameBoard = document.getElementById('gameBoard');
      gameBoard.innerHTML = "";
      // Create category headers in the fixed order.
      currentCategories.forEach(cat => {
        const div = document.createElement('div');
        div.className = 'category';
        div.textContent = cat;
        gameBoard.appendChild(div);
      });
      // Create 5 rows (for $100, $200, $300, $400, $500).
      for (let i = 0; i < 5; i++) {
        currentCategories.forEach(cat => {
          const qData = roundData[cat][i];
          const cell = document.createElement('div');
          cell.className = 'question';
          cell.id = cat + "-" + i;
          cell.textContent = "$" + qData.value;
          cell.onclick = function() { openQuestion(cat, i); };
          gameBoard.appendChild(cell);
        });
      }
    }
    
    // ---------------- Scoreboard and Active Player ----------------
    function displayScoreBoard() {
      const scoreBoard = document.getElementById('scoreBoard');
      scoreBoard.innerHTML = "";
      players.forEach((player, index) => {
        const div = document.createElement('div');
        div.className = 'playerScore';
        div.id = 'player' + index;
        if (index === currentPlayer) div.classList.add('active-player');
        div.innerHTML = `<h3>${player.name}</h3><p>Score: <span id="score${index}">${player.score}</span></p>`;
        scoreBoard.appendChild(div);
      });
      scoreBoard.style.display = 'flex';
    }
    
    function updateScoreBoard() {
      players.forEach((player, index) => {
        document.getElementById('score' + index).textContent = player.score;
      });
    }
    
    function updateActivePlayerDisplay() {
      players.forEach((_, index) => {
        const playerDiv = document.getElementById('player' + index);
        if (index === currentPlayer) playerDiv.classList.add('active-player');
        else playerDiv.classList.remove('active-player');
      });
    }
    
    // ---------------- Question Modal and Answer Logic ----------------
    function openQuestion(category, index) {
      if (!roundData[category] || !roundData[category][index]) return;
      currentCategory = category;
      currentIndex = index;
      currentQuestion = roundData[category][index];
      selectedChoiceIndex = null;
      currentWager = 0;
      
      document.getElementById('questionText').textContent = currentQuestion.question;
      document.getElementById('modalContent').innerHTML = "";
      document.getElementById('choiceContainer').innerHTML = "";
      document.getElementById('feedback').innerHTML = "";
      document.getElementById('confirmButton').style.display = 'none';
      
      // If Daily Double, prompt for wager.
      if (currentQuestion.dailyDouble) {
        const maxWager = players[currentPlayer].score > 0 ? players[currentPlayer].score : 1000;
        const wagerDiv = document.createElement('div');
        wagerDiv.innerHTML = `<p><strong>Daily Double!</strong> Enter your wager (max: ${maxWager}):</p>`;
        const wagerInput = document.createElement('input');
        wagerInput.type = "number";
        wagerInput.id = "wagerInput";
        wagerInput.value = currentQuestion.value;
        wagerDiv.appendChild(wagerInput);
        const wagerButton = document.createElement('button');
        wagerButton.textContent = "Confirm Wager";
        wagerButton.onclick = confirmWager;
        wagerDiv.appendChild(wagerButton);
        document.getElementById('modalContent').appendChild(wagerDiv);
      } else {
        showChoices();
      }
      document.getElementById('questionModal').style.display = 'block';
    }
    
    function confirmWager() {
      const wagerInput = document.getElementById('wagerInput');
      let wager = parseInt(wagerInput.value);
      const maxWager = players[currentPlayer].score > 0 ? players[currentPlayer].score : 1000;
      if (isNaN(wager) || wager <= 0) {
        alert("Please enter a positive wager.");
        return;
      }
      if (wager > maxWager) {
        alert("Your wager cannot exceed " + maxWager + " points.");
        return;
      }
      currentWager = wager;
      document.getElementById('modalContent').innerHTML = "";
      showChoices();
    }
    
    function showChoices() {
      const choiceContainer = document.getElementById('choiceContainer');
      choiceContainer.innerHTML = "";
      currentQuestion.choices.forEach((choice, idx) => {
        const p = document.createElement('p');
        p.className = 'choice';
        p.textContent = choice;
        p.onclick = function() { selectChoice(p, idx); };
        choiceContainer.appendChild(p);
      });
      document.getElementById('confirmButton').style.display = 'inline-block';
    }
    
    function selectChoice(element, idx) {
      const choices = document.getElementsByClassName('choice');
      for (let i = 0; i < choices.length; i++) {
        choices[i].classList.remove('selected');
      }
      element.classList.add('selected');
      selectedChoiceIndex = idx;
    }
    
    function confirmAnswer() {
      if (selectedChoiceIndex === null) {
        alert("Please select an answer before confirming.");
        return;
      }
      let wagerOrValue = currentQuestion.dailyDouble ? currentWager : currentQuestion.value;
      let feedbackText = "";
      if (selectedChoiceIndex === currentQuestion.answer) {
        feedbackText = "Correct! You gain " + wagerOrValue + " points.";
        players[currentPlayer].score += wagerOrValue;
      } else {
        feedbackText = "Incorrect. The correct answer was: " + currentQuestion.choices[currentQuestion.answer] +
                       ". You lose " + wagerOrValue + " points.<br><em>Explanation: " + currentQuestion.explanation + "</em>";
        players[currentPlayer].score -= wagerOrValue;
        if (players.length > 1) {
          currentPlayer = (currentPlayer + 1) % players.length;
        }
      }
      document.getElementById('feedback').innerHTML = feedbackText;
      updateScoreBoard();
      updateActivePlayerDisplay();
      delete roundData[currentCategory][currentIndex];
      const cell = document.getElementById(currentCategory + "-" + currentIndex);
      if (cell) {
        cell.style.background = "#555";
        cell.style.color = "#aaa";
        cell.onclick = null;
        cell.textContent = "";
      }
      document.getElementById('confirmButton').style.display = 'none';
      questionsAnswered++;
      if (questionsAnswered === totalQuestionsPerRound) {
        if (round === 1) {
          round = 2;
          alert("Round 1 complete! Now entering Double Jeopardy (point values doubled).");
          initializeRound();
        } else {
          setTimeout(startFinalJeopardy, 1000);
        }
      }
    }
    
    function closeModal() {
      document.getElementById('questionModal').style.display = 'none';
    }
    
    // ---------------- Final Jeopardy ----------------
    function startFinalJeopardy() {
      document.getElementById('gameBoard').style.display = 'none';
      const finalQuestion = finalJeopardyBank[Math.floor(Math.random() * finalJeopardyBank.length)];
      const container = document.getElementById('finalQuestionContainer');
      container.innerHTML = `<h3>${finalQuestion.question}</h3>`;
      const responsesDiv = document.getElementById('finalPlayerResponses');
      responsesDiv.innerHTML = "";
      players.forEach((player, idx) => {
        responsesDiv.innerHTML += `<div id="finalPlayer${idx}">
          <h4>${player.name} (Current Score: ${player.score})</h4>
          <p>Enter your wager (max: ${player.score > 0 ? player.score : 1000}): <input type="number" id="finalWager${idx}" value="0"></p>
          <p>Your Answer (enter the option letter): <input type="text" id="finalAnswer${idx}" placeholder="e.g., C"></p>
          </div><hr>`;
      });
      window.finalQuestion = finalQuestion;
      document.getElementById('finalModal').style.display = 'block';
    }
    
    function finalConfirm() {
      players.forEach((player, idx) => {
        const wager = parseInt(document.getElementById('finalWager' + idx).value);
        const answer = document.getElementById('finalAnswer' + idx).value.trim();
        const maxWager = player.score > 0 ? player.score : 1000;
        let wagerVal = isNaN(wager) || wager <= 0 ? 0 : wager;
        if (wagerVal > maxWager) wagerVal = maxWager;
        const correctOption = window.finalQuestion.choices[window.finalQuestion.answer].charAt(0).toUpperCase();
        const givenOption = answer.charAt(0).toUpperCase();
        if (givenOption === correctOption) {
          player.score += wagerVal;
        } else {
          player.score -= wagerVal;
        }
      });
      updateScoreBoard();
      alert("Final Jeopardy complete! Check the scoreboard for final results.");
      document.getElementById('finalModal').style.display = 'none';
    }
  </script>
</body>
</html>
